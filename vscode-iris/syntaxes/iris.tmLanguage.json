{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "IRIS",
  "scopeName": "source.iris",
  "fileTypes": ["iris"],
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#fstrings" },
    { "include": "#keywords" },
    { "include": "#declarations" },
    { "include": "#types" },
    { "include": "#constants" },
    { "include": "#functions" },
    { "include": "#operators" },
    { "include": "#numbers" },
    { "include": "#builtins" },
    { "include": "#identifiers" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.iris",
          "match": "//.*$"
        }
      ]
    },
    "strings": {
      "name": "string.quoted.double.iris",
      "begin": "\"",
      "end": "\"",
      "patterns": [
        {
          "name": "constant.character.escape.iris",
          "match": "\\\\(n|t|r|\\\\|\")"
        }
      ]
    },
    "fstrings": {
      "name": "string.interpolated.iris",
      "begin": "f\"",
      "end": "\"",
      "patterns": [
        {
          "name": "meta.embedded.iris",
          "begin": "\\{",
          "end": "\\}",
          "patterns": [
            { "include": "$self" }
          ]
        },
        {
          "name": "constant.character.escape.iris",
          "match": "\\\\(n|t|r|\\\\|\")"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.flow.iris",
          "match": "\\b(if|else|when|for|while|loop|break|continue|return|in)\\b"
        },
        {
          "name": "keyword.control.iris",
          "match": "\\b(val|var|bring|pub)\\b"
        },
        {
          "name": "keyword.declaration.iris",
          "match": "\\b(def|record|choice|type|const|extern|trait|impl|async|await|spawn|par|where)\\b"
        },
        {
          "name": "keyword.operator.iris",
          "match": "\\b(to|and|or|not)\\b"
        }
      ]
    },
    "declarations": {
      "patterns": [
        {
          "name": "meta.function.definition.iris",
          "match": "\\b(def)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\b",
          "captures": {
            "1": { "name": "keyword.declaration.iris" },
            "2": { "name": "entity.name.function.iris" }
          }
        },
        {
          "name": "meta.record.definition.iris",
          "match": "\\b(record|choice)\\s+([A-Z][a-zA-Z0-9_]*)\\b",
          "captures": {
            "1": { "name": "keyword.declaration.iris" },
            "2": { "name": "entity.name.type.iris" }
          }
        },
        {
          "name": "meta.type.alias.iris",
          "match": "\\b(type)\\s+([A-Z][a-zA-Z0-9_]*)\\b",
          "captures": {
            "1": { "name": "keyword.declaration.iris" },
            "2": { "name": "entity.name.type.iris" }
          }
        },
        {
          "name": "meta.const.definition.iris",
          "match": "\\b(const)\\s+([A-Z_][A-Z0-9_]*)\\b",
          "captures": {
            "1": { "name": "keyword.declaration.iris" },
            "2": { "name": "entity.name.constant.iris" }
          }
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "support.type.primitive.iris",
          "match": "\\b(i64|i32|i8|u8|u32|u64|usize|f64|f32|bool|str)\\b"
        },
        {
          "name": "support.type.iris",
          "match": "\\b(option|result|list|map|tensor|tuple|chan|atomic|grad|sparse)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.iris",
          "match": "\\b(true|false|none|unit)\\b"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.float.iris",
          "match": "\\b[0-9]+\\.[0-9]+([eE][+-]?[0-9]+)?\\b"
        },
        {
          "name": "constant.numeric.hex.iris",
          "match": "\\b0x[0-9a-fA-F]+\\b"
        },
        {
          "name": "constant.numeric.integer.iris",
          "match": "\\b[0-9]+\\b"
        }
      ]
    },
    "builtins": {
      "patterns": [
        {
          "name": "support.function.builtin.iris",
          "match": "\\b(print|panic|assert|len|concat|contains|starts_with|ends_with|to_upper|to_lower|trim|repeat|to_str|format|read_line|read_i64|read_f64|split|join|find|slice|str_index|parse_i64|parse_f64|list|push|pop|list_get|list_set|list_len|list_pop|map|map_get|map_set|map_keys|map_values|map_contains|some|none|is_some|unwrap|ok|err|is_ok|is_err|cell|cell_get|cell_set|zeros|ones|fill|linspace|sqrt|abs|floor|ceil|sin|cos|tan|exp|log|log2|round|sign|pow|min|max|clamp|band|bor|bxor|shl|shr|bitnot|grad|grad_of|sparsify|densify|atomic|atomic_load|atomic_store|atomic_add|channel|send|recv|einsum|to_str|some|none)\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.arithmetic.iris",
          "match": "(\\+|-|\\*|/|%)"
        },
        {
          "name": "keyword.operator.comparison.iris",
          "match": "(==|!=|<=|>=|<|>)"
        },
        {
          "name": "keyword.operator.logical.iris",
          "match": "(&&|\\|\\||!)"
        },
        {
          "name": "keyword.operator.assignment.iris",
          "match": "="
        },
        {
          "name": "keyword.operator.arrow.iris",
          "match": "->"
        },
        {
          "name": "keyword.operator.range.iris",
          "match": "\\.\\."
        },
        {
          "name": "keyword.operator.question.iris",
          "match": "\\?"
        }
      ]
    },
    "functions": {
      "patterns": [
        {
          "name": "meta.function.call.iris",
          "match": "\\b([a-z_][a-zA-Z0-9_]*)\\s*(?=\\()",
          "captures": {
            "1": { "name": "entity.name.function.call.iris" }
          }
        }
      ]
    },
    "identifiers": {
      "patterns": [
        {
          "name": "variable.other.iris",
          "match": "\\b[a-z_][a-zA-Z0-9_]*\\b"
        },
        {
          "name": "entity.name.type.iris",
          "match": "\\b[A-Z][a-zA-Z0-9_]*\\b"
        }
      ]
    }
  }
}
